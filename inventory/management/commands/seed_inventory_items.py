from __future__ import annotations

from decimal import Decimal
from typing import Sequence

from django.core.management.base import BaseCommand

from inventory.models import BasicItem

INVENTORY_ITEMS: Sequence[tuple[str, str, str]] = [
    ('آبلیمو', '1 لیتری', '305000'),
    ('پرارین', '1100 گرم', '540000'),
    ('ویمتو', '1 لیتری', '330000'),
    ('سرشیر', '1 کیلو', '600000'),
    ('حوله کیولین 6 رول', '1 بسته', '282200'),
    ('نی 6', '1 بسته', '68200'),
    ('دستکش لاتکس', '1 بسته', '422400'),
    ('آب انار', '1 لیتری', '333000'),
    ('دستمال کوکتل', '1 بسته', '171600'),
    ('شیر', '1 لیتری', '74000'),
    ('ماست یونانی', '900 گرم', '106000'),
    ('آب انگور تکدانه', '1 لیتری', '105000'),
    ('کمپوت سیب', '400 گرم', '85000'),
    ('لیمو ترش', '1 کیلو', '290000'),
    ('عسل', '1 کیلو', '600000'),
    ('دستکش یکبار مصرف', '1 بسته', '60000'),
    ('گودا کاله', '250 گرم', '365000'),
    ('آب انبه سان استار', '1 لیتری', '170000'),
    ('آب سیب سان استار', '1 لیتری', '150000'),
    ('خامه کاله', '200 سی سی', '58000'),
    ('آب آناناس سان استار', '200 سی سی', '33000'),
    ('نعنا موهیتو', '1 بسته', '125000'),
    ('نان بربری', '1 عدد', '20000'),
    ('لیوان 500 شفاف', '50 عدد', '225700'),
    ('درب لیوان 500 مشکی', '50 عدد', '76600'),
    ('سیروپ دارچین سن ایچ', '1 عدد', '210000'),
    ('کمپوت هلو', '420 گرم', '80000'),
    ('آب انگور قرمز سن ایچ', '1 لیتری', '170000'),
    ('رب انار سمیه', '350 گرم', '200000'),
    ('آب سیب سن ایچ', '1 لیتری', '150000'),
    ('آب هلو سان استار', '1 لیتری', '150000'),
    ('دستکش کرال بزرگ', '1 بسته', '110000'),
    ('کیسه زباله فله', '1 کیلو', '80000'),
    ('اسپری چوب 500 میلی لیتری', '1 عدد', '113000'),
    ('نارنگی', '1 کیلو', '140000'),
    ('پرتقال', '1 کیلو', '95000'),
    ('دستمال توالت 12 تایی', '1 بسته', '287000'),
    ('اسکاچ', '1 عدد', '35000'),
    ('بادام هندی', '1 کیلو', '1450000'),
    ('مایع ظرف شویی', '1 لیتری', '93000'),
    ('کیسه زباله 40*50', '1 بسته', '135000'),
    ('فیلتر چایی بزرگ', '1 بسته', '75000'),
    ('جو دوسر پرک OAB', '900 گرم', '435000'),
    ('ژامبون ایتالیایی', '1 کیلو', '773000'),
    ('مایع استیم', '1 عدد', '3300000'),
    ('چای سرد دم', '200 گرم', '450000'),
    ('انگور', '1 کیلو', '160000'),
    ('سیب', '1 کیلو', '100000'),
    ('شیشه پاک کن', '1 عدد', '70000'),
    ('قارچ صدفی', '300 گرمی', '160000'),
    ('مغز پسته کامل', '1 کیلو', '2200000'),
    ('مغز پسته نصف', '1 کیلو', '1600000'),
    ('خرما پیارم', '1 کیلو', '780000'),
    ('مربا توت فرنگی موسوی', '320 گرمی', '142000'),
    ('مربا آلبالو موسوی', '320 گرمی', '185000'),
    ('نی تک سلفون 8', '1 عدد', '2500'),
    ('پینک رز مومنتی', '250 گرم', '908000'),
    ('ماسالا مومنتی', '700 گرمی', '715000'),
    ('چای سبز مومنتی', '500 گرمی', '700000'),
    ('پودر پولی کف', '900 گرم', '1650000'),
    ('کمپوت آناناس', '565 گرم', '245000'),
    ('بیبی اسفناج', '1 بسته', '125000'),
    ('ریحان ایتالیایی', '1 بسته', '138000'),
    ('گرین فارم میکس', '1 بسته', '95000'),
    ('موز', '1 کیلو', '98000'),
    ('زباله', '1 رول', '225000'),
    ('پنیر شیرازی', '300 گرمی', '100000'),
    ('تک ظرف دلیوری 1800', '1 عدد', '35000'),
    ('ماچا', '100 گرمی', '1150000'),
    ('سیروپ بارتینی', '700 میلی لیتر', '450000'),
    ('دمنوش به', '1 کیلو', '485000'),
    ('دمنوش سیب', '1 کیلو', '450000'),
    ('آب آناناس', '1 لیتری', '192000'),
    ('مایع دستشویی', '1 لیتری', '70000'),
    ('زیتون سبز بی هسته', '500 گرمی', '187000'),
    ('خلال دندان', '1 بسته', '300000'),
    ('خشبو کننده محیط', '1 عدد', '247000'),
    ('مغز فندوق', '1 کیلو', '2250000'),
    ('خودکار کیان', '1 عدد', '9000'),
    ('قاشق یکبار مصرف الگانت', '1 بسته', '66000'),
    ('تک ظرف دلیوری 2500', '1 عدد', '60000'),
    ('فریزر رولی 250 عددی', '1 رول', '115000'),
    ('دستکش ظرفشویی', '1 بسته', '125000'),
]


class Command(BaseCommand):
    help = "Seed curated inventory items (name, unit, and price) into BasicItem."

    def add_arguments(self, parser):
        parser.add_argument(
            '--prune-missing',
            action='store_true',
            help='Delete BasicItem rows not present in the curated seed list.',
        )

    def handle(self, *args, **options):
        prune_missing: bool = options['prune_missing']
        keep_ids: list[int] = []

        for name, unit, price in INVENTORY_ITEMS:
            unit_price = Decimal(price)
            obj, created = BasicItem.objects.update_or_create(
                name=name,
                defaults={'unit': unit, 'unit_price': unit_price},
            )
            keep_ids.append(obj.id)
            action = 'created' if created else 'updated'
            self.stdout.write(f"{action:>7}: {obj.name}")

        if prune_missing:
            deleted, _ = BasicItem.objects.exclude(id__in=keep_ids).delete()
            if deleted:
                self.stdout.write(
                    self.style.WARNING(f"pruned: {deleted} item(s) not in curated list")
                )

        self.stdout.write(
            self.style.SUCCESS(
                f"Seeded {len(INVENTORY_ITEMS)} inventory items into BasicItem."
            )
        )
